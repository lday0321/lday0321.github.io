<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="lday" />



<meta name="description" content="讨论群中关于切片的一个问题Q1：对slice的append无效在群里有人提问，下述代码对slice的append无效">
<meta property="og:type" content="article">
<meta property="og:title" content="细看Go中的切片(slice)">
<meta property="og:url" content="http://lday.me/2017/02/25/0004_golang-slice-depth/index.html">
<meta property="og:site_name" content="lday的博客">
<meta property="og:description" content="讨论群中关于切片的一个问题Q1：对slice的append无效在群里有人提问，下述代码对slice的append无效">
<meta property="og:image" content="http://og43lpuu1.bkt.clouddn.com/golang_slice_depth/png01_array.png">
<meta property="og:image" content="http://og43lpuu1.bkt.clouddn.com/golang_slice_depth/png02_slice-struct.png">
<meta property="og:image" content="http://og43lpuu1.bkt.clouddn.com/golang_slice_depth/png03_slice-1.png">
<meta property="og:updated_time" content="2017-03-11T16:17:28.287Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="细看Go中的切片(slice)">
<meta name="twitter:description" content="讨论群中关于切片的一个问题Q1：对slice的append无效在群里有人提问，下述代码对slice的append无效">
<meta name="twitter:image" content="http://og43lpuu1.bkt.clouddn.com/golang_slice_depth/png01_array.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="lday的博客" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>细看Go中的切片(slice) | lday的博客</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/assets/blogImg/donkey.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">lday</a></h1>
        </hgroup>

        
        <p class="header-subtitle">Life, Coding, Funning</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:oneday0321@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/lday0321" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/">Kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/boost/">boost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cpp/">cpp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/etcd/">etcd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hello/">hello</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hello1/">hello1</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">lday, 80后IT码农一枚. 白羊座，喜热闹</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">lday</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/assets/blogImg/donkey.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">lday</a></h1>
            </hgroup>
            
            <p class="header-subtitle">Life, Coding, Funning</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:oneday0321@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/lday0321" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-0004_golang-slice-depth" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/25/0004_golang-slice-depth/" class="article-date">
      <time datetime="2017-02-25T04:24:11.000Z" itemprop="datePublished">2017-02-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      细看Go中的切片(slice)
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/">golang</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="讨论群中关于切片的一个问题"><a href="#讨论群中关于切片的一个问题" class="headerlink" title="讨论群中关于切片的一个问题"></a>讨论群中关于切片的一个问题</h1><h2 id="Q1：对slice的append无效"><a href="#Q1：对slice的append无效" class="headerlink" title="Q1：对slice的append无效"></a>Q1：对slice的append无效</h2><p>在群里有人提问，下述<a href="https://play.golang.org/p/jWy3kP2A25" target="_blank" rel="external">代码</a>对slice的append无效</p>
<a id="more"></a>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	list := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">2</span>)</div><div class="line">	add(list)</div><div class="line">	fmt.Println(list)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(list []<span class="keyword">int</span>)</span></span> &#123;</div><div class="line">	list = <span class="built_in">append</span>(list, <span class="number">100</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行结果：</p>
<pre><code>[0 0]
</code></pre><p>有人给出的解释是：</p>
<blockquote>
<p>在add函数中执行append后，切片由于当前可用空间不足而执行了扩容，实际地址发送了变化，因此外层访问的list并非append后的list地址</p>
</blockquote>
<h2 id="Q2：即使空间足够，slice不扩容，对slice的append还是无效"><a href="#Q2：即使空间足够，slice不扩容，对slice的append还是无效" class="headerlink" title="Q2：即使空间足够，slice不扩容，对slice的append还是无效"></a>Q2：即使空间足够，slice不扩容，对slice的append还是无效</h2><p>根据上面的解释，提问者修改了示例<a href="https://play.golang.org/p/G0WE7S22Wq" target="_blank" rel="external">代码</a>，以确保切片当前的可用空间足够，append时不进行扩容，仍然保持原有的list地址，但修改后的代码对slice的append仍然无效：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	list := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">100</span>) <span class="comment">//leave enough space</span></div><div class="line">	add(list)</div><div class="line">	fmt.Println(list)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(list []<span class="keyword">int</span>)</span></span> &#123;</div><div class="line">  	list = <span class="built_in">append</span>(list, <span class="number">100</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>执行结果：</p>
<pre><code>[]
</code></pre><h1 id="细看slice"><a href="#细看slice" class="headerlink" title="细看slice"></a>细看slice</h1><p>出于对上述现象的好奇，我对Go中slice的相关的内容进行了一些梳理</p>
<h2 id="类型系统"><a href="#类型系统" class="headerlink" title="类型系统"></a>类型系统</h2><p>在《The Go Programming Language》中，作者将Go中的数据类型做了如下分类：</p>
<blockquote>
<p>Go’s types fall into four categories: basic types, aggregate types, reference types, and interface types. Basic types, … include numbers, strings, and booleans. Aggregate types—arrays … and structs … form more complicated data types by combining values of several simpler ones. Reference types are a diverse group that includes pointers …, <strong>slices</strong> …, maps …, functions …, and channels …, but what they have in common is that they all refer to program variables or state indirectly, so that the effect of an operation applied to one reference is observed by all copies of that reference. Finally, … interface types … (from p.51)</p>
</blockquote>
<p>但是，从上面的示例我们显然发现，slice并非是我们想象中的那样的“引用”类型。仔细阅读《The Go Programming Language》中关于slice介绍的章节(section 4.2)，我么会进一步看到：</p>
<blockquote>
<p>Updating the slice variable is required not just when calling append, but for <strong>any function that may change the length or capacity of a slice or make it refer to a different underlying array</strong>. … In this respect, slices are not <strong>“pure”</strong> reference types but resemble an aggreate type… (from p.91)</p>
</blockquote>
<p>从这里我们就可以看到，slice的确并非我们所预想的那样。</p>
<h3 id="值语义和引用语义"><a href="#值语义和引用语义" class="headerlink" title="值语义和引用语义"></a>值语义和引用语义</h3><p>Go中大多数类型都是基于值语义的：</p>
<ul>
<li>基本类型：byte、int、bool、float32、float64和string等</li>
<li>复合类型：<strong>数组(array)</strong>、结构体(struct)、指针(pointer)等</li>
</ul>
<p>另外还有4个类型比较特别，分别是：</p>
<ul>
<li>数组切片(slice)</li>
<li>映射(map)</li>
<li>通道(channel)</li>
<li>接口(interface)</li>
</ul>
<p>多数时候，上述4类型被认为具有引用语义的行为，而实际上如果细看，我认为这些类型还是值语义，只是这些类型的结构都是“具有指针成员变量”的结构体。因此在多数时候，将该类型变量传递后（实际上是结构体传递），能够通过指针成员变量在传递前后访问到相同的数据内容，因此，而被视为具有引用语义的类型。</p>
<p>总的来看，我认为Go语义类型是值语义！</p>
<h2 id="内部结构"><a href="#内部结构" class="headerlink" title="内部结构"></a>内部结构</h2><p>要弄明白为什么切片也是值语义，我们必须了解切片和数组的整体结构</p>
<h3 id="array的组织结构"><a href="#array的组织结构" class="headerlink" title="array的组织结构"></a>array的组织结构</h3><p>和C/C++类似，Go中的数组也是一块连续的内存空间</p>
<p><img src="http://og43lpuu1.bkt.clouddn.com/golang_slice_depth/png01_array.png" alt=""></p>
<p>如上图所示，一个<a href="https://play.golang.org/p/jWy3kP2A25" target="_blank" rel="external">4</a>int的数组，其内存空间则是4个连续的int。Go中的数组是值语义。意味着每一次复制，每一次参数传递，都是将整个array的内存拷贝一遍。</p>
<h3 id="slice的组织结构"><a href="#slice的组织结构" class="headerlink" title="slice的组织结构"></a>slice的组织结构</h3><p>切片是“可变长”数组，为了做到动态的可扩容，实际上，切片的结构的内存空间如下图所示：</p>
<p><img src="http://og43lpuu1.bkt.clouddn.com/golang_slice_depth/png02_slice-struct.png" alt=""></p>
<p>实际上他是一个具有三个域的结构，包括一个指向底层存放数据内容的数组指针ptr, 一个记录当前slice长度的len和一个记录当前slice容量大小的cap。</p>
<p>当对slice进行定义初始化时，则会为ptr赋予实际的内存空间地址，指向实际的底层数组：</p>
<p><img src="http://og43lpuu1.bkt.clouddn.com/golang_slice_depth/png03_slice-1.png" alt=""></p>
<p>经过上面对slice结构的描述，我们就可以看到，对slice的赋值以及函数参数传递，实际上是对slice结构:</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> &#123;</div><div class="line">	ptr *Elem</div><div class="line">    <span class="built_in">len</span> <span class="keyword">int</span></div><div class="line">    <span class="built_in">cap</span> <span class="keyword">int</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>的复制。由于slice赋值前后的两个变量，在不发生slice底层数组容量扩容（实际指针地址改变）的情况下，前后两个slice变量的ptr将指向同一块数组空间，因此，此时通过一个slice变量修改slice内某一位置的值，通过另外一个slice变量是可以访问到改变的。而如果修改了len或者cap变量，由于赋值前后两个slice变量是保存了len/cap各自的副本，因此在一个slice变量中的修改，将无法反应到另外一个slice的内容上</p>
<p>进一步的，我们也可以认为map本质上也是一个字典指针：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//具体实现</span></div><div class="line"><span class="keyword">type</span> MAP_K_V <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//对外暴露的map类型</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">map</span>[K]V <span class="keyword">struct</span> &#123;</div><div class="line">	impl *Map_K_V</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同样的channel的实现实际上也是类似的结构，而接口的实现，则是他内部具有两个指针：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> <span class="keyword">interface</span> <span class="keyword">struct</span> &#123;</div><div class="line">    date *void</div><div class="line">    itab *Itab</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述几个结构，都是在其暴露的结构体中具有指针类型，而使得看似该类型具有引用语音。而当我们明白了其内部构造，我们就会形成统一的认识，上述类型实际上是基于指针实现的值语义，进而在行为上具有类似引用语义的行为</p>
<h2 id="对问题的分析"><a href="#对问题的分析" class="headerlink" title="对问题的分析"></a>对问题的分析</h2><p>结合上面对slice的理解，我们可以发现，在上述Q2的代码描述中，实际上已经将100写入到list的空间了， 只是因为slice是值传递，在add里面，list的len修改为1， 但是出了add，list的len还是0，此时用Println是打印不出作者写入的100的（Println会根据len打印具体长度的数据）</p>
<p>为了验证我们的猜测，我们可以不直接初始化slice底层的array，而是通过基于一个现成的array来完成slice的构建，这个构建过程叫做切片化(slicing)<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	underlyArray := [<span class="number">5</span>]<span class="keyword">int</span>&#123;&#125;</div><div class="line">	list := underlyArray[<span class="number">0</span>:<span class="number">0</span>]  <span class="comment">// slicing</span></div><div class="line"></div><div class="line">	fmt.Println(underlyArray[<span class="number">0</span>])</div><div class="line">	</div><div class="line">	add(list)</div><div class="line">	</div><div class="line">	fmt.Println(list)</div><div class="line">	fmt.Println(underlyArray[<span class="number">0</span>])</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(list []<span class="keyword">int</span>)</span></span> &#123;</div><div class="line">  	list = <span class="built_in">append</span>(list, <span class="number">100</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>执行<a href="https://play.golang.org/p/PNvCKIeLek" target="_blank" rel="external">代码</a></p>
<pre><code>0
[]
100
</code></pre><p>输出结果验证了我们的猜想，虽然赋值前后的len/cap是各自的副本，但由于slice的指针指向了同一块array，该array[0]在add函数中被修改为100，因此，在函数add外面，我们如果通过底层的array，直接访问array[0]，我们会看到，这个100已经被写入，而且可以被访问拿到。而由于外层函数的list保留了自己len=0, cap=0的副本，因此在打印时，由于底层数组长度被认为是0，而被放弃输出第0位的100</p>
<h1 id="进一步思考"><a href="#进一步思考" class="headerlink" title="进一步思考"></a>进一步思考</h1><p>当在闭包closure之外修改了slice的内容，闭包内访问slice，能看到更新的内容吗？<br>答案和上述示例类似，No!</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://blog.golang.org/go-slices-usage-and-internals" target="_blank" rel="external">Go Slices: usage and internals</a><br><a href="https://blog.golang.org/slices" target="_blank" rel="external">Arrays, slices (and strings): The mechanics of ‘append’</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2017/02/25/0004_golang-slice-depth/">细看Go中的切片(slice)</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">lday</a></p>
        <p><span>发布时间:</span>2017-02-25, 12:24:11</p>
        <p><span>最后更新:</span>2017-03-12, 00:17:28</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2017/02/25/0004_golang-slice-depth/" title="细看Go中的切片(slice)">http://lday.me/2017/02/25/0004_golang-slice-depth/</a>
            <span class="copy-path" data-clipboard-text="原文: http://lday.me/2017/02/25/0004_golang-slice-depth/　　作者: lday" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2017/02/27/0005_gdb-vs-dlv/">
                    Golang程序调试工具介绍(gdb vs dlv)
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2017/02/01/0003_seri-stm-etcd3/">
                    基于etcd3的访问序列化及分布式软事务内存
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#讨论群中关于切片的一个问题"><span class="toc-number">1.</span> <span class="toc-text">讨论群中关于切片的一个问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Q1：对slice的append无效"><span class="toc-number">1.1.</span> <span class="toc-text">Q1：对slice的append无效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q2：即使空间足够，slice不扩容，对slice的append还是无效"><span class="toc-number">1.2.</span> <span class="toc-text">Q2：即使空间足够，slice不扩容，对slice的append还是无效</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#细看slice"><span class="toc-number">2.</span> <span class="toc-text">细看slice</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#类型系统"><span class="toc-number">2.1.</span> <span class="toc-text">类型系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#值语义和引用语义"><span class="toc-number">2.1.1.</span> <span class="toc-text">值语义和引用语义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内部结构"><span class="toc-number">2.2.</span> <span class="toc-text">内部结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#array的组织结构"><span class="toc-number">2.2.1.</span> <span class="toc-text">array的组织结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#slice的组织结构"><span class="toc-number">2.2.2.</span> <span class="toc-text">slice的组织结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对问题的分析"><span class="toc-number">2.3.</span> <span class="toc-text">对问题的分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#进一步思考"><span class="toc-number">3.</span> <span class="toc-text">进一步思考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">4.</span> <span class="toc-text">参考资料</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"细看Go中的切片(slice)　| lday的博客　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'http://lday.me/2017/02/25/0004_golang-slice-depth/';
            this.page.identifier = '2017/02/25/0004_golang-slice-depth/';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//lday.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2017/02/27/0005_gdb-vs-dlv/" title="上一篇: Golang程序调试工具介绍(gdb vs dlv)">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2017/02/01/0003_seri-stm-etcd3/" title="下一篇: 基于etcd3的访问序列化及分布式软事务内存">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/07/15/0010_kafka_producer_analysis_01/">Kafka Procuder小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/0009_why_not_413/">为什么没有收到预期的413状态码</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/27/0008_kafka_vs_tranditional_mq/">Kafka与传统消息中间件的差异</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/22/0007_elasticsearch_summary/">ElasticSearch总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/19/0006_boost-multi-index-container/">多维索引容器(multi_index_container)的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/27/0005_gdb-vs-dlv/">Golang程序调试工具介绍(gdb vs dlv)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/25/0004_golang-slice-depth/">细看Go中的切片(slice)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/01/0003_seri-stm-etcd3/">基于etcd3的访问序列化及分布式软事务内存</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/04/0002_hi/">你好，世界</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/03/0001_hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2017 lday
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>